<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="light" />
  <title>The Tasks I Hated Today</title>

  <style>
    :root{
      --bg0:#f7fbff;
      --bg1:#eef4fb;

      --ink:#1f2937;
      --muted:#6b7280;

      --glass: rgba(255,255,255,.55);

      /* Paper */
      --paper:#ffffff;
      --paper-tint:#fbfdff;
      --paper-edge: rgba(17, 24, 39, .12);
      --paper-shadow: 0 26px 70px rgba(12, 33, 54, .14), 0 4px 16px rgba(12, 33, 54, .08);
      --paper-shadow-focus: 0 28px 78px rgba(12, 33, 54, .16), 0 4px 16px rgba(12, 33, 54, .08), 0 0 0 5px rgba(185,212,242,.42);
      --rule: rgba(130, 150, 175, .28);
      --rule-strong: rgba(130, 150, 175, .38);

      --bin:#9aa7b5;
    }

    *{ box-sizing:border-box; }
    html, body { height: 100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color:var(--ink);
      overflow:hidden;
      background:
        radial-gradient(1200px 800px at 30% 10%, rgba(185,212,242,.55), transparent 55%),
        radial-gradient(1000px 700px at 75% 20%, rgba(210,222,236,.65), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
    }

    /* Suggestion of an empty modern office: blurred daylight + soft shapes */
    .office-haze{
      position:fixed;
      inset:-40px;
      pointer-events:none;
      filter: blur(18px);
      opacity:.46;
      background:
        radial-gradient(160px 120px at 20% 35%, rgba(255,255,255,.9), transparent 70%),
        radial-gradient(260px 160px at 62% 40%, rgba(160,184,210,.65), transparent 72%),
        radial-gradient(320px 220px at 82% 62%, rgba(255,255,255,.85), transparent 70%),
        radial-gradient(220px 160px at 35% 70%, rgba(170,196,222,.55), transparent 70%),
        linear-gradient(90deg, rgba(255,255,255,.25), rgba(255,255,255,0));
      transform: scale(1.05);
    }

    /* Atmospheric grain */
    .grain{
      position:fixed;
      inset:0;
      pointer-events:none;
      opacity:.12;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='220' height='220' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
      mix-blend-mode:multiply;
    }

    .wrap{
      position:relative;
      height:100%;
      width:100%;
      display:grid;
      place-items:center;
      padding: 28px 18px 140px;
    }

    .title{
      position:absolute;
      top: 20px;
      left: 0; right:0;
      text-align:center;
      letter-spacing:.02em;
      font-weight:600;
      font-size:14px;
      color: rgba(31,41,55,.72);
      user-select:none;
    }
    .title span{
      display:inline-block;
      padding: 10px 14px;
      border-radius: 999px;
      background: var(--glass);
      box-shadow: 0 8px 22px rgba(12, 33, 54, .08);
      backdrop-filter: blur(8px);
    }

    .stage{
      width:min(900px, 94vw);
      display:grid;
      place-items:center;
      gap:14px;
    }

    /* === NOTEBOOK PAPER (matches your reference vibe) ===
       - perforation holes strip on the left
       - ruled lines
       - torn bottom edge (clip-path)
       - soft drop shadow + subtle realism
    */
    .paper{
      position:relative;
      width:min(820px, 94vw);
      height: 112px;
      transform: rotate(-0.35deg);
      box-shadow: var(--paper-shadow);
      border: 1px solid var(--paper-edge);
      background:
        /* gentle paper tint */
        radial-gradient(110% 90% at 30% 15%, rgba(255,255,255,.95), rgba(248,252,255,.96) 55%, rgba(245,250,255,.98) 100%),
        linear-gradient(180deg, rgba(255,255,255,.98), rgba(252,253,255,1));
      overflow:hidden;

      /* torn bottom + slightly imperfect corners */
      border-radius: 12px;
      clip-path: polygon(
        1% 0%, 99% 0%,
        99% 86%,
        96% 88%, 93% 92%, 89% 90%, 85% 94%, 81% 92%, 77% 96%, 73% 93%,
        69% 97%, 65% 94%, 61% 98%, 57% 95%, 53% 99%, 49% 96%, 45% 99%,
        41% 95%, 37% 98%, 33% 94%, 29% 97%, 25% 93%, 21% 96%, 17% 92%,
        13% 94%, 9% 90%, 6% 92%, 3% 88%,
        1% 86%
      );

      will-change: transform, opacity, filter;
    }

    /* Paper fibers texture (very subtle) */
    .paper::before{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      opacity:.22;
      background-image:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='240' height='240'%3E%3Cfilter id='t'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.65' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='240' height='240' filter='url(%23t)' opacity='.55'/%3E%3C/svg%3E");
      mix-blend-mode:multiply;
    }

    /* Ruled lines + subtle edge shading */
    .paper::after{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      background:
        /* ruled lines area (leaves room for holes strip) */
        linear-gradient(90deg, rgba(255,255,255,.0) 0 56px, rgba(255,255,255,0) 56px 100%),
        repeating-linear-gradient(
          to bottom,
          rgba(255,255,255,0) 0px,
          rgba(255,255,255,0) 17px,
          var(--rule) 17px,
          var(--rule) 18px
        ),
        /* slight top shading like your reference */
        radial-gradient(120% 70% at 50% 0%, rgba(0,0,0,.06), transparent 55%),
        /* slight bottom depth */
        radial-gradient(120% 80% at 50% 92%, rgba(0,0,0,.05), transparent 60%);
      opacity:.92;
      mix-blend-mode:multiply;
    }

    /* Left perforation strip + holes */
    .holes{
      position:absolute;
      left:0;
      top:0;
      bottom:0;
      width: 56px;
      pointer-events:none;

      /* paper margin strip */
      background:
        linear-gradient(90deg, rgba(240,246,255,.95), rgba(255,255,255,0) 70%),
        radial-gradient(70% 120% at 100% 50%, rgba(0,0,0,.06), transparent 62%);

      /* holes via repeating radial gradients */
      mask-image: linear-gradient(#000, #000); /* keep it simple + consistent */
    }

    .holes::before{
      content:"";
      position:absolute;
      left: 18px;
      top: 14px;
      width: 20px;
      height: calc(100% - 28px);
      background:
        radial-gradient(circle at 50% 9px, rgba(0,0,0,.22) 0 2px, rgba(0,0,0,0) 3px),
        radial-gradient(circle at 50% 9px, rgba(255,255,255,.95) 0 6px, rgba(255,255,255,0) 7px);
      background-size: 100% 20px;
      background-repeat: repeat-y;
      opacity:.95;
      filter: blur(.0px);
      mix-blend-mode:multiply;
    }

    /* tiny “torn notch” on bottom-left like notebook tear */
    .tear-notch{
      position:absolute;
      left: 8px;
      bottom: 2px;
      width: 36px;
      height: 22px;
      pointer-events:none;
      background:
        radial-gradient(18px 14px at 30% 55%, rgba(0,0,0,.10), transparent 70%),
        radial-gradient(22px 16px at 55% 65%, rgba(255,255,255,.65), transparent 70%);
      opacity:.35;
      mix-blend-mode:multiply;
      transform: rotate(-2deg);
    }

    .paper:focus-within{
      box-shadow: var(--paper-shadow-focus);
    }

    .inputRow{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      gap: 10px;
      /* pad left so text starts after holes strip */
      padding: 18px 18px 18px 72px;
    }

    input[type="text"]{
      appearance:none;
      border:0;
      outline:0;
      background:transparent;
      font-size: 18px;
      line-height: 1;
      width: 100%;
      color: var(--ink);
      caret-color: rgba(31,41,55,.92);
    }
    input[type="text"]::placeholder{
      color: rgba(107,114,128,.74);
    }

    .send{
      width: 36px;
      height: 36px;
      display:grid;
      place-items:center;
      border-radius: 10px;
      border: 1px solid rgba(17, 24, 39, .10);
      background: rgba(240,247,255,.82);
      box-shadow: 0 10px 22px rgba(12, 33, 54, .10);
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, opacity .12s ease;
      user-select:none;
      flex: 0 0 auto;
    }
    .send:hover{ transform: translateY(-1px); background: rgba(240,247,255,.95); }
    .send:active{ transform: translateY(0px) scale(.98); }
    .send[aria-disabled="true"]{ opacity:.45; cursor:default; }

    .hint{
      text-align:center;
      font-size: 12.5px;
      color: rgba(107,114,128,.75);
      user-select:none;
    }

    /* Trash bin */
    .bin{
      position: fixed;
      left: 50%;
      bottom: 22px;
      transform: translateX(-50%);
      width: 120px;
      height: 110px;
      display:grid;
      place-items:end center;
      pointer-events:none;
      filter: drop-shadow(0 16px 28px rgba(12, 33, 54, .18));
    }
    .bin svg{ width: 120px; height: 110px; }

    .privacy{
      position: fixed;
      bottom: 18px;
      left: 18px;
      right: 18px;
      display:flex;
      justify-content:space-between;
      gap:12px;
      font-size: 11.5px;
      color: rgba(107,114,128,.78);
      user-select:none;
      pointer-events:none;
    }
    .privacy .pill{
      padding: 8px 10px;
      border-radius: 999px;
      background: var(--glass);
      box-shadow: 0 10px 24px rgba(12, 33, 54, .08);
      backdrop-filter: blur(8px);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 100%;
    }

    /* --- Crumpled paper ball (for toss) --- */
    .paper.flyer { will-change: transform, opacity, filter; }

    .paperBall{
      position: fixed;
      width: 54px;
      height: 54px;
      border-radius: 999px;
      background: radial-gradient(120% 120% at 30% 25%,
        rgba(255,255,255,.96),
        rgba(240,245,252,.96) 45%,
        rgba(220,230,242,.99) 100%);
      border: 1px solid rgba(17, 24, 39, .10);
      box-shadow:
        0 18px 35px rgba(12, 33, 54, .18),
        inset 0 10px 18px rgba(255,255,255,.55),
        inset 0 -10px 22px rgba(0,0,0,.10);
      pointer-events: none;
      z-index: 60;
      transform: translate3d(0,0,0);
      filter: saturate(1.02);
      clip-path: polygon(
        12% 22%, 24% 8%, 46% 5%, 66% 10%, 86% 24%,
        95% 45%, 90% 68%, 76% 88%, 54% 96%, 30% 90%,
        14% 74%, 6% 52%
      );
    }
    .paperBall::before{
      content:"";
      position:absolute;
      inset:-8px;
      border-radius: 999px;
      background:
        radial-gradient(22px 16px at 30% 30%, rgba(255,255,255,.55), transparent 60%),
        radial-gradient(26px 18px at 65% 40%, rgba(0,0,0,.10), transparent 65%),
        radial-gradient(18px 14px at 45% 70%, rgba(0,0,0,.08), transparent 60%),
        radial-gradient(26px 20px at 60% 70%, rgba(255,255,255,.35), transparent 65%);
      opacity:.78;
      filter: blur(.3px);
    }
    .paperBall::after{
      content:"";
      position:absolute;
      inset:0;
      border-radius: 999px;
      background:
        radial-gradient(120% 90% at 50% 15%, rgba(255,255,255,.45), transparent 55%),
        radial-gradient(100% 90% at 55% 70%, rgba(0,0,0,.12), transparent 60%);
      opacity:.65;
    }

    @media (prefers-reduced-motion: reduce){
      .office-haze{ filter: blur(10px); }
    }
  </style>
</head>

<body>
  <div class="office-haze"></div>
  <div class="grain"></div>

  <div class="wrap" role="application" aria-label="The Tasks I Hated Today — anonymous one-line vent box">
    <div class="title"><span>The Tasks I Hated Today</span></div>

    <main class="stage">
      <div id="paper" class="paper" aria-label="Complaint paper">
        <div class="holes" aria-hidden="true"></div>
        <div class="tear-notch" aria-hidden="true"></div>

        <div class="inputRow">
          <input
            id="complaint"
            type="text"
            inputmode="text"
            maxlength="160"
            autocomplete="off"
            autocapitalize="sentences"
            spellcheck="true"
            placeholder="Write it. Crumple it. Throw it away."
            aria-label="Type a one-line complaint and press Enter"
          />
          <button id="send" class="send" type="button" aria-label="Submit" title="Submit (Enter)">
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M21 3L10 14" stroke="rgba(31,41,55,.72)" stroke-width="1.8" stroke-linecap="round"/>
              <path d="M21 3L14.5 21l-4.1-7.2L3 9.5 21 3Z"
                    stroke="rgba(31,41,55,.72)" stroke-width="1.8" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
      </div>

      <div class="hint" aria-hidden="true">One line only. No names. No history.</div>
    </main>

    <div class="bin" aria-hidden="true">
      <svg viewBox="0 0 140 130" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="g" x1="0" y1="0" x2="0" y2="1">
            <stop offset="0" stop-color="#b9c5d1"/>
            <stop offset="1" stop-color="#8e9aa7"/>
          </linearGradient>
          <linearGradient id="g2" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0" stop-color="#7d8a98" stop-opacity=".7"/>
            <stop offset="1" stop-color="#ffffff" stop-opacity=".2"/>
          </linearGradient>
        </defs>
        <ellipse cx="70" cy="26" rx="46" ry="14" fill="rgba(255,255,255,.45)"/>
        <ellipse cx="70" cy="28" rx="48" ry="15" fill="url(#g)" opacity=".95"/>
        <ellipse cx="70" cy="28" rx="40" ry="11" fill="rgba(240,247,255,.78)"/>
        <path d="M26 30c6 58 10 86 14 90 10 10 50 10 60 0 4-4 8-32 14-90"
              fill="url(#g)" stroke="rgba(17,24,39,.16)" stroke-width="1.2"/>
        <path d="M46 35c-2 50-2 78 0 86" stroke="rgba(255,255,255,.35)" stroke-width="2" opacity=".7"/>
        <path d="M60 33c-1 54-1 80 0 90" stroke="rgba(255,255,255,.25)" stroke-width="2" opacity=".65"/>
        <path d="M80 33c1 54 1 80 0 90" stroke="rgba(0,0,0,.12)" stroke-width="2" opacity=".45"/>
        <path d="M94 35c2 50 2 78 0 86" stroke="rgba(0,0,0,.10)" stroke-width="2" opacity=".45"/>
        <path d="M34 44c8-12 24-15 38-14" fill="none" stroke="url(#g2)" stroke-width="10" opacity=".35" stroke-linecap="round"/>
        <ellipse cx="70" cy="124" rx="42" ry="10" fill="rgba(12,33,54,.18)"/>
      </svg>
    </div>

    <div class="privacy" aria-hidden="true">
      <div class="pill">Anonymous. No login. No history. No tracking.</div>
      <div class="pill" id="statusPill">Ready.</div>
    </div>
  </div>

  <script>
    /**
     * The Tasks I Hated Today — single-file minimalist app
     * - One-line anonymous submission
     * - Fire-and-forget POST to Google Apps Script endpoint
     * - “Crumple into a ball + throw into bin” animation
     */

    // ✅ Your deployed Google Apps Script Web App URL
    const ENDPOINT = "https://script.google.com/a/macros/nvidia.com/s/AKfycbzyhDoUoiR-UadUZHxQwQplyECOJ6zPZCGs5GmV-ojk2TiP-_c0Yi7OntlFEKt9o3z6/exec";

    const paper = document.getElementById("paper");
    const input = document.getElementById("complaint");
    const sendBtn = document.getElementById("send");
    const statusPill = document.getElementById("statusPill");

    let busy = false;
    const reduceMotion = window.matchMedia("(prefers-reduced-motion: reduce)").matches;

    function setStatus(text){ statusPill.textContent = text; }

    function sanitizeOneLine(s){
      return (s || "")
        .replace(/[\r\n]+/g, " ")
        .replace(/\s+/g, " ")
        .trim();
    }

    // Optional ultra-subtle whoosh (no external files)
    let audioCtx = null;
    function softWhoosh(){
      if (reduceMotion) return;
      try{
        audioCtx = audioCtx || new (window.AudioContext || window.webkitAudioContext)();
        const t0 = audioCtx.currentTime;

        const bufferSize = Math.floor(audioCtx.sampleRate * 0.12);
        const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
        const data = buffer.getChannelData(0);
        for (let i=0;i<bufferSize;i++){
          data[i] = (Math.random()*2-1) * (1 - i/bufferSize) * 0.18;
        }

        const src = audioCtx.createBufferSource();
        src.buffer = buffer;

        const filter = audioCtx.createBiquadFilter();
        filter.type = "highpass";
        filter.frequency.setValueAtTime(600, t0);
        filter.frequency.exponentialRampToValueAtTime(1400, t0 + 0.10);

        const gain = audioCtx.createGain();
        gain.gain.setValueAtTime(0.0001, t0);
        gain.gain.exponentialRampToValueAtTime(0.035, t0 + 0.02);
        gain.gain.exponentialRampToValueAtTime(0.0001, t0 + 0.12);

        src.connect(filter);
        filter.connect(gain);
        gain.connect(audioCtx.destination);

        src.start(t0);
        src.stop(t0 + 0.12);
      }catch(e){}
    }

    async function postToSheet(complaint){
      const payload = { complaint, timestamp: new Date().toISOString() };

      // Fire-and-forget CORS-safe approach
      try{
        await fetch(ENDPOINT, {
          method: "POST",
          mode: "no-cors",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
          keepalive: true
        });
        return true;
      }catch(_){}

      // Fallback: form-encoded
      try{
        const form = new URLSearchParams(payload);
        await fetch(ENDPOINT, {
          method: "POST",
          mode: "no-cors",
          headers: { "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8" },
          body: form.toString(),
          keepalive: true
        });
        return true;
      }catch(_){
        return false;
      }
    }

    function lockUI(locked){
      input.disabled = locked;
      sendBtn.setAttribute("aria-disabled", locked ? "true" : "false");
    }

    function createFlyingPaper(text){
      const rect = paper.getBoundingClientRect();

      const flyer = document.createElement("div");
      flyer.className = "paper flyer";
      flyer.style.position = "fixed";
      flyer.style.left = rect.left + "px";
      flyer.style.top = rect.top + "px";
      flyer.style.width = rect.width + "px";
      flyer.style.height = rect.height + "px";
      flyer.style.margin = "0";
      flyer.style.zIndex = "50";
      flyer.style.pointerEvents = "none";
      flyer.style.transform = "rotate(-0.35deg) translate3d(0,0,0)";

      // include holes + notch so the flying paper matches the on-screen paper
      const holes = document.createElement("div");
      holes.className = "holes";
      holes.setAttribute("aria-hidden","true");
      const notch = document.createElement("div");
      notch.className = "tear-notch";
      notch.setAttribute("aria-hidden","true");
      flyer.appendChild(holes);
      flyer.appendChild(notch);

      const row = document.createElement("div");
      row.className = "inputRow";
      row.style.padding = "18px 18px 18px 72px";
      const p = document.createElement("div");
      p.style.fontSize = "18px";
      p.style.color = "rgba(31,41,55,.92)";
      p.style.whiteSpace = "nowrap";
      p.style.overflow = "hidden";
      p.style.textOverflow = "ellipsis";
      p.textContent = text;
      row.appendChild(p);
      flyer.appendChild(row);

      document.body.appendChild(flyer);
      return { flyer };
    }

    function makePaperBallFromFlyer(flyer){
      const r = flyer.getBoundingClientRect();
      const ball = document.createElement("div");
      ball.className = "paperBall";

      const size = 54;
      ball.style.left = (r.left + r.width/2 - size/2) + "px";
      ball.style.top  = (r.top  + r.height/2 - size/2) + "px";

      document.body.appendChild(ball);
      return ball;
    }

    async function animateCrumpleAndToss(text){
      if (reduceMotion){
        const { flyer } = createFlyingPaper(text);
        await flyer.animate(
          [{ opacity: 1 }, { opacity: 0, transform: "translateY(40px) scale(.98)" }],
          { duration: 240, easing: "ease-out", fill: "forwards" }
        ).finished;
        flyer.remove();
        return;
      }

      const { flyer } = createFlyingPaper(text);

      const binEl = document.querySelector(".bin");
      const binRect = binEl.getBoundingClientRect();

      const flyerRect = flyer.getBoundingClientRect();
      const startCx = flyerRect.left + flyerRect.width/2;
      const startCy = flyerRect.top + flyerRect.height/2;

      const targetCx = binRect.left + binRect.width/2;
      const targetCy = binRect.top + 30;

      // Phase 1: slight grip
      await flyer.animate(
        [
          { transform: "rotate(-0.35deg) translate3d(0,0,0)", filter: "blur(0px)", opacity: 1 },
          { transform: "rotate(-0.9deg) translate3d(0,-2px,0)", filter: "blur(0px)", opacity: 1 }
        ],
        { duration: 110, easing: "cubic-bezier(.2,.9,.2,1)", fill: "forwards" }
      ).finished;

      // Phase 2: crumple collapse
      const crumpleAnim = flyer.animate(
        [
          { transform: "rotate(-0.9deg) translate3d(0,-2px,0) scale(1)", filter: "blur(0px)", opacity: 1 },
          { transform: "rotate(3deg) translate3d(0,2px,0) scale(.92) skewX(-3deg)", filter: "blur(.25px)", opacity: .98, offset: .35 },
          { transform: "rotate(-10deg) translate3d(0,6px,0) scale(.78) skewX(4deg)", filter: "blur(.8px)", opacity: .93, offset: .72 },
          { transform: "rotate(-18deg) translate3d(0,10px,0) scale(.62) skewX(-6deg)", filter: "blur(1.2px)", opacity: .85 }
        ],
        { duration: 320, easing: "cubic-bezier(.15,.8,.2,1)", fill: "forwards" }
      );

      // wrinkle overlay
      const wrinkle = document.createElement("div");
      wrinkle.style.position = "absolute";
      wrinkle.style.inset = "-2px";
      wrinkle.style.pointerEvents = "none";
      wrinkle.style.opacity = "0";
      wrinkle.style.background =
        "radial-gradient(240px 80px at 28% 38%, rgba(0,0,0,.10), transparent 60%)," +
        "radial-gradient(260px 90px at 72% 58%, rgba(0,0,0,.07), transparent 64%)," +
        "radial-gradient(200px 70px at 50% 45%, rgba(255,255,255,.30), transparent 62%)," +
        "radial-gradient(180px 60px at 40% 70%, rgba(255,255,255,.22), transparent 62%)";
      flyer.appendChild(wrinkle);

      wrinkle.animate(
        [{ opacity: 0 }, { opacity: .62, offset: .55 }, { opacity: .20 }],
        { duration: 320, easing: "ease-out", fill: "forwards" }
      );

      await crumpleAnim.finished;

      const ball = makePaperBallFromFlyer(flyer);

      const ballPop = ball.animate(
        [
          { transform: "scale(.92) rotate(-6deg)", opacity: 0.0, offset: 0 },
          { transform: "scale(1.06) rotate(8deg)",  opacity: 0.95, offset: .55 },
          { transform: "scale(1.00) rotate(0deg)",  opacity: 1.0, offset: 1 }
        ],
        { duration: 140, easing: "cubic-bezier(.2,.9,.2,1)", fill: "forwards" }
      );

      flyer.animate(
        [{ opacity: .85 }, { opacity: 0 }],
        { duration: 120, easing: "ease-out", fill: "forwards" }
      ).finished.then(() => flyer.remove());

      softWhoosh();
      await ballPop.finished;

      // Toss arc
      const dx = (targetCx - startCx) + (Math.random()*16 - 8);
      const dy = (targetCy - startCy);

      const midX = dx * 0.55;
      const midY = dy * 0.45 - 95;

      const rot1 = (Math.random()*30 - 15);
      const rot2 = rot1 + (Math.random()*60 - 30);

      const toss = ball.animate(
        [
          { transform: "translate3d(0,0,0) rotate(0deg) scale(1)", opacity: 1 },
          { transform: `translate3d(${midX}px, ${midY}px, 0) rotate(${rot1}deg) scale(.92)`, opacity: .98, offset: .45 },
          { transform: `translate3d(${dx*0.88}px, ${dy*0.88}px, 0) rotate(${(rot1+rot2)/2}deg) scale(.44)`, opacity: .26, offset: .78 },
          { transform: `translate3d(${dx}px, ${dy}px, 0) rotate(${rot2}deg) scale(.30)`, opacity: 0.06 }
        ],
        { duration: 760, easing: "cubic-bezier(.12,.88,.2,1)", fill: "forwards" }
      );

      await toss.finished;
      ball.remove();
    }

    async function submit(){
      if (busy) return;

      const complaint = sanitizeOneLine(input.value);
      if (!complaint){
        input.value = "";
        input.focus();
        return;
      }

      busy = true;
      lockUI(true);
      setStatus("Letting go…");

      const textForAnim = complaint;
      input.value = "";

      const postPromise = postToSheet(complaint);
      await animateCrumpleAndToss(textForAnim);

      const ok = await postPromise;
      setStatus(ok ? "Gone." : "Gone (offline).");

      await new Promise(r => setTimeout(r, 420));
      setStatus("Ready.");
      lockUI(false);
      input.focus();
      busy = false;
    }

    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter"){
        e.preventDefault();
        submit();
      }
    });

    sendBtn.addEventListener("click", () => {
      if (sendBtn.getAttribute("aria-disabled") === "true") return;
      submit();
    });

    input.addEventListener("paste", (e) => {
      e.preventDefault();
      const text = (e.clipboardData || window.clipboardData).getData("text");
      const oneLine = sanitizeOneLine(text);
      const start = input.selectionStart ?? input.value.length;
      const end = input.selectionEnd ?? input.value.length;
      input.value = input.value.slice(0, start) + oneLine + input.value.slice(end);
      const pos = start + oneLine.length;
      input.setSelectionRange(pos, pos);
    });

    window.addEventListener("load", () => {
      input.focus({ preventScroll:true });
    });
  </script>
</body>
</html>